<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customize Salad</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet" />
  <style>
    .section h2 {
      margin-top: 15px;
      color: #5c4332;
    }

    .btn-row button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 1.2em;
      background: #ffe9d6;
      border: 2px dashed #a0755c;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .btn-row button:hover {
      background: #fff3e6;
    }

    .customize-container {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <button onclick="history.back()" class="back-button">&larr; Back</button>

  <div class="customize-container">
    <h1>ðŸ¥— Customize Your Salad</h1>

    <form id="customize-form">
      <div class="section">
        <h2>Extra Toppings (â‚¹20 each):</h2>
        <div class="options">
          <label><input type="checkbox" name="toppings" value="Cheese" /> Cheese</label>
          <label><input type="checkbox" name="toppings" value="Olives" /> Olives</label>
          <label><input type="checkbox" name="toppings" value="Corn" /> Corn</label>
          <label><input type="checkbox" name="toppings" value="Croutons" /> Croutons</label>
        </div>
      </div>

      <div class="section">
        <h2>Dressings (you can choose multiple):</h2>
        <div class="options">
          <label><input type="checkbox" name="dressings" value="Ranch" /> Ranch</label>
          <label><input type="checkbox" name="dressings" value="Honey Mustard" /> Honey Mustard</label>
          <label><input type="checkbox" name="dressings" value="Sweet Onion" /> Sweet Onion</label>
          <label><input type="checkbox" name="dressings" value="Mintolicious" /> Mintolicious</label>
        </div>
      </div>

      <div class="section">
        <h2>Quantity:</h2>
        <input type="number" name="quantity" min="1" value="1" required />
      </div>

      <input type="hidden" id="salad-name" />
      <input type="hidden" id="salad-price" />

      <div class="btn-row">
        <button type="button" id="add-to-cart">ðŸ›’ Add to Cart</button>
        <button type="button" id="place-order">âœ… Place Order</button>
      </div>

      <div class="link-row">
        <a href="salad-list.html" class="link-btn">+ Add More Items</a>
        <a href="cart.html" class="link-btn">ðŸ›’ Go to Cart</a>
      </div>
    </form>
  </div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const name = urlParams.get('name');
  const price = parseFloat(urlParams.get('price'));

  document.getElementById("salad-name").value = name;
  document.getElementById("salad-price").value = price;

  const form = document.getElementById("customize-form");

  function getOrderDetails() {
    const toppings = [...form.elements["toppings"]]
      .filter(i => i.checked)
      .map(i => i.value);

    const dressings = [...form.elements["dressings"]]
      .filter(i => i.checked)
      .map(i => i.value);

    const quantity = parseInt(form.elements["quantity"].value);
    const toppingCost = toppings.length * 20;
    const total = quantity * (price + toppingCost);

    return {
      name,
      price,
      toppings,
      dressings,
      quantity,
      total,
      timestamp: new Date().toISOString()
    };
  }

  document.getElementById("add-to-cart").addEventListener("click", () => {
    const order = getOrderDetails();
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    cart.push(order);
    localStorage.setItem("cart", JSON.stringify(cart));
    alert("âœ¨ Added to Cart!");
  });

  document.getElementById("place-order").addEventListener("click", async () => {
    const order = getOrderDetails();
    localStorage.setItem("saladOrder", JSON.stringify(order));

    try {
      await fetch("https://salad-kiosk.onrender.com/api/orders", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(order)
      });
    } catch (err) {
      console.error("Failed to send to backend:", err);
    }

    window.location.href = "payment.html";
  });
</script>

</body>
</html>
